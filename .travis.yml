language: python
dist: jammy  # Use Ubuntu 22.04

python:
  - "3.13"

before_install:
  # Download the latest version of the coverage-reporter binary
  - curl -L https://github.com/coverallsapp/coverage-reporter/releases/latest/download/coveralls-linux.tar.gz -o coveralls.tar.gz
  # Extract the binary
  - tar -xzf coveralls.tar.gz

install:
  - pip install -r requirements.txt

before_script:
  - python manage.py migrate
  - python manage.py collectstatic --noinput

script:
  - black --check .
  - flake8 .
  - coverage run --source=mysite,polls manage.py test
  # Convert the coverage data to the lcov format for the universal reporter
  - coverage lcov -o coverage.lcov

after_scripts:
  # Run the reporter. It automatically finds the coverage.lcov file and the repo token.
  - ./coveralls

deploy:
  provider: elasticbeanstalk
  access_key_id:
    secure: "Encrypted <access-key-id>="
  secret_access_key:
    secure: "Encypted <secret-access-key>="
  region: "us-east-1"
  app: "djangotutorial"
  env: "djangotutorial-dev"
  bucket_name: "elasticbeanstalk-us-east-1-620079905652"